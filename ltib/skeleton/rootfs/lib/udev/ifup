#!/bin/sh
#first argument the name of a newly detected network interface
#when /var/lock/if.pending exists, actions are deferred
#otherwise, this brings interface UP if it was down
exec 7<&- 5<&-
exec >>/dev/console 2>&1
#exec >>/var/run/trace/ifup-$1.trace 2>&1
#echo "udev: ifup $1" >&2
#set -x

#ignore virtual devices
case "$DEVPATH" in
 /devices/virtual/*) exit 0
esac

lockFn=/var/lock/ifup.pending  #must be empty before udevd starts
[ -r $lockFn ] && {
  exec 7<$lockFn  #acquire lock
  flock -x 7 && [ -e $lockFn ] && exec echo -n "$1 " >>$lockFn  #defer ifup
  exec 7<&-       #release lock.  Did not need to defer ifup.  Do it now!
}
exec /usr/sbin/ifup $1 "''|y|yes|1|true" &  #if AUTOSTART missing,yes, or true

#catchup command starts interfaces listed in ifup.pending
